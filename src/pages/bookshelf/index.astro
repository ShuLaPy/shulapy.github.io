---
import Main from "@/layouts/Main.astro";
import Layout from "@/layouts/Layout.astro";
import Header from "@/components/Header.astro";
import Footer from "@/components/Footer.astro";
import { SITE } from "@/config";
import { getCollection } from "astro:content";

const books = await getCollection("books");

const sortedBooks = books.sort(
  (a, b) => b.data.pubDatetime.valueOf() - a.data.pubDatetime.valueOf()
);
---

<Layout title={`Bookshelf | ${SITE.title}`}>
  <Header />
  <Main pageTitle="Bookshelf" pageDesc="All the books I've read or am reading.">
    <ul class="space-y-4">
      {
        sortedBooks.map(({ id, data }) => (
          <li class="group border-skin-line/40 flex items-start gap-4 border-b pb-4">
            {data.cover && (
              <a href={`/bookshelf/${id}/`} class="flex-shrink-0">
                <img
                  src={data.thumbnail}
                  alt={data.title}
                  class="border-skin-line/20 h-16 w-12 rounded border bg-white object-cover shadow-sm transition-transform group-hover:scale-105"
                />
              </a>
            )}
            <div class="flex flex-grow items-center justify-between">
              <div class="flex flex-col">
                <a
                  href={`/bookshelf/${id}/`}
                  class="text-skin-base text-lg font-medium decoration-dashed underline-offset-4 group-hover:underline focus-visible:no-underline focus-visible:underline-offset-0"
                >
                  {data.title}
                </a>
                <span class="text-sm italic opacity-70">{data.author}</span>
              </div>
              <div class="flex flex-col items-end gap-1">
                <span class="border-skin-line text-skin-inverted bg-skin-fill/10 dark:bg-skin-accent/10 dark:text-skin-accent rounded-full border px-2 py-0.5 text-xs">
                  {data.category}
                </span>
                <span class="flex items-center gap-1 text-xs opacity-60">
                  {data.readingStatus}
                </span>
              </div>
            </div>
          </li>
        ))
      }
    </ul>
  </Main>
  <Footer />
</Layout>
